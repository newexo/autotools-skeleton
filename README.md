autotools-skeleton
==================

I use this skeleton autotools project when I begin a new C++ project. For convenience, I keep this here in a github repository. Since there is nothing secret about this, I see no reason for the repository to be private. Perhaps others may find this useful, since I have found no other examples of skeleton autotools projects. This repository contains all of the files needed to create a very basic `configure` file, which in turn will generate a cross-compiling a makefile.

The requirements to use this are `autoconf`, `automake` and `libtool`, which are available with most Linux distributions, or Homebrew on Mac.

## Generating configure file

The most important files are `configure.ac`, which specifies what tool chain the configuration file should eventually search for, and `Makefile.am`, which specifies make targets. The `configure.ac` here is for C and C++, but similar files can be written for Objective-C, Java and C# among other languages.

`Makefile.am` specifies location of source files and resulting libraries and executables.

To generate the configuration script, invoke

	autoreconf -i
	
Note that this will generate a file called `COPYING` which contains the GNU license. If you desire a different license, then before invoking `autoreconf`, write your own `COPYING` file and check that into source control.

The files `AUTHORS` `ChangeLog` `NEWS` and `README` are expected by `autoreconf`, though they may be empty. The file `m4/NOTES` is expected for these `configure.ac` and `Makefile.am`.

## Making the makefile

Once the `autoreconf` and `automake` are run, the results should be checked into source control, because they will be required to run on systems that may not have the autotools installed. After that, generate the makefile by invoking

	./configure
	
That script searches the system for a tool chain, libraries and generates a makefile. Invoke that makefile by

	make
	
which will build a static library named `libhello.a`, an executable named `hello` and a test running executable named `testhello`. Finally, `make` will actually execute `testhello`.

## Customizing 

As noted already, most customization should be done by changing the files `configure.ac` and `Makefile.am`. It may be worth saying again that the file `COPYING` is expected to contain the license agreement, and if the file does not exist, it will be written with the GNU license agreement.

### configure.ac

In `configure.ac`, the line

	AC_INIT([hello], [0.1], [rkbrasher@gmail.com])

should be changed so that `[hello]` gives the name of the project or package, `[0.1]` the version number, and `[rkbrasher@gmail.com]` an email address for bug reports.

The line

	AC_CONFIG_SRCDIR([src/hello.cpp])

should be changed so that `[src/hello.cpp]` is any unique file name in the source directory. This location is used as a sanity check for when makefiles are run from directories other than the base directory of the project.

### Makefile.am

In `Makefile.am`, the line

	AM_CXXFLAGS = -g -pedantic -Wall -std=c++11 -Iinclude -Isrc

specifies compiler flags for the C++ compiler. The line 

	all: libhello.a hello testhello test

specifies the targets that will be built when `make` is invoked with no specific target. In this case, there are four targets which are defined later, either implicitly or explicitly.

The lines

	lib_LIBRARIES = libhello.a
	libhello_a_SOURCES = include/hello.h src/libhello.cpp

specify the rules for building static library `libhello.a`.

The lines

	bin_PROGRAMS = hello testhello
	hello_SOURCES = $(libhello_a_SOURCES) src/hello.cpp
	testhello_SOURCES = $(libhello_a_SOURCES) src/tests/testhello.cpp

specify the rules for generating two executables, `hello` and `testhello`.

The lines 

	test: testhello
		./testhello

specify the rules of the `test` target, which will actually execute `testhello` once it is built. The first of these two lines specifies that `test` depends on `testhello`, another target previously defined. Note that in the second line the whitespace must actually be a tab character, otherwise `make` will complain that you don't know what you are doing.

## Using with `git`

The `.gitignore` file here is an example to modify for a real project. This example does not ignore the files generated by `autoreconf`, but does ignore files generated by `configure` and `make`. Whether you wish to do things this way could be considered a matter of style.

Sometimes there is a problem when trying to use a project setup this way if the system on which `autoreconf` was run has a different version of autotools than the system on which `configure` and `make` were run which may result in the infamous  [aclocal.m4] Error 127. The problem is that the timestamps on the files generated by `autoreconf` will not be the same on the systems because on one system the files were generated, and on the other, the files were pulled down from a repository. The fix is to run a script file like the `install-dependencies.sh` script here, which touches the appropriate autotools generated files so that they will have correct timestamps. 
